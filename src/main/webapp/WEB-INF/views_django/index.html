{% extends "layout.html" %}

{% block content %}

<script type="text/javascript">
     function doFormSubmit() {
    	$('#oda-gear').show();
    	var swfuploadify = window['uploadify_' + 'file_upload'];
    	swfuploadify.addPostParam('platformId', $('#platformSelect').val());
	 	$('#file_upload').uploadifyUpload();
 	}
	 function doFormCancel() {
		 $('#modal-from-dom').modal('hide');
	 }
 
 $(document).ready(function() { 
 	
	 var processDisassembly = function(ret) { 
		$('#listing').html(ret.opcodeHtml);
		$('#rawBytes').html(ret.rawBytesHtml);
		$('#offset').html(ret.offsetHtml);
		$('#branchLines').html(ret.branchTargetHtml);
		
		$('#strings-content').html(ret.stringHtml);
		$('#sections-content').html(ret.sectionHtml);
        $('#hex-content').val(ret.hexDump);
		$('#modal-from-dom').modal('hide');
		$('#oda-gear').hide();  
	 };
	 
	 $('#login-form').popover({
		 html: true,
		 placement: 'below',
		 delayOut: '5000',
		 content: function() { 
			 return '<p>Do you already have an account on one of these sites? Click the logo to log in with it here:</p>'
					 +'<a href="openid?provider=google"><img src="/resources/images/openid_google.png"/></a> '
					 + '<a href="openid?provider=yahoo"><img src="/resources/images/openid_yahoo.png"/></a>'; } 
	 }); 
	 $('#login-form').popover('show');
	 setTimeout(function() {$('#login-form').popover('hide');},6000 ); 
	 $('.tabs').tabs();
	 $('#assembly-tab-item').trigger('click');
	 
	 $('#save-hex,#disassembleBtn').click(function() { 
		 $('#oda-gear').show(); 
		 $.ajax('/rest/disassemble/uploadHex',{
			 type: 'POST',
			 data: {
				 	hex : $('#hex-content').val(), 
				 	platformId : $('#platformSelect').val(), 
				 	endian : $('#endianSelect').val(),
				 	offset : $('#offsetInput').val()
			  }, 
			 success: function(data) { 
				// var ret = jQuery.parseJSON( data ); 	
				 processDisassembly(data); 
				 $('#assembly-tab-item').trigger('click');
			 }
		 }); 
		 return false; 
	 }); 
	 
  $('#file_upload').uploadify({
     	// Required Settings
		//langFile : '/jquery.uploadify-v3.0.0/uploadifyLang_en.js',
		swf : '/resources/scripts/lib/uploadify/uploadify.swf',
		checkExisting : '/rest/disassemble/checkExisting',
		uploader : '/rest/disassemble/uploadFile;jsessionid={{sessionId}}', 
		//debug : true, 
		buttonText : 'SELECT FILE',
		auto : false,
		buttonImage : '',
		cancelImage : '/resources/images/uploadify-cancel.png',
		multi : false,
		fileTypeExts : '*',
		progressData    : 'all',		
		'removeCompleted' : true,
		onUploadSuccess : function(file,data,response) {
			var ret = jQuery.parseJSON( data ); 	
			processDisassembly(ret); 
		}		  
     });    
 }); 
 
 $(document).ready(function() {
     $('#file-upload-btn').click(function() { 
         $('#modal-from-dom').modal('show');
     }); 
 }); 

 </script>

<div class="content">
    <div class="page-header row">
        <img src="/resources/images/oda.png" class="span2" style="width: 128px; height: 128px;"/>
        <img src="/resources/images/oda.gif" style="width: 128px; height: 128px; float:left; position: relative; left: -128px; margin-right:-128px; display:none;" id="oda-gear"/>
        <h1 class="span6">The Online Disassembler</h1> 
    </div>
             
    <ul class="tabs" data-tabs="tabs">
        <li class="active"><a href="#hex">Hex</a></li>
        <li><a href="#assembly" id="assembly-tab-item">Assembly</a></li>
        <li><a href="#strings">Strings</a></li>
        <li><a href="#sections">Sections</a></li>
    </ul>
          
    <div id="my-tab-content" class="tab-content">
        
        <!--  HEX TAB CONTENT -->
        <div class="active tab-pane" id="hex">
            <form class="well">
                <input class="btn primary" type="submit" value="Save" id="save-hex">
            </form>
            <textarea style="width:100%; height:400px;"  id="hex-content">Enter raw hex bytes here.</textarea>
              
        </div>
        
        <!--  ASSEMBLY TAB CONTENT -->
        <div class="tab-pane" id="assembly">
            <form class="well">
                <div class="row">
            	    <div class="input span3">
            		    <button data-controls-modal="modal-from-dom" data-backdrop="true" data-keyboard="true" class="btn danger">Upload File</button> 
            		</div>
                    <label for="platformSelect">Platform</label>
            		<div class="input span2">
		                <select id="platformSelect" name="normalSelect" class="span2">
		                    <option>X86</option>
		                    <option>MIPS</option>
		                    <option>ARM</option>
		                    <option>PPC</option>		                
		                </select>
		            </div>
		            <label for="endianSelect">Endian</label>
            		<div class="input span2">
		                <select id="endianSelect" name="normalSelect" class="span2">
		                    <option>LITTLE</option>
		                    <option>BIG</option>
		                    <option>DEFAULT</option>
		                </select>
		            </div>
		            <label for="offsetInput">Offset</label>
		            <input id="offsetInput" class="span2" type="text" name="offset" value="0x0"/>
		            <input class="btn primary pull-right" type="submit" id="disassembleBtn" value="Disassemble">
		        </div>
            </form>
			<div class="tabbed-scroll assembly">
                <div id="branchLines" style="width:200px; text-align:right; float:left; font-family:DejaVuSansMono; color:#093C83"></div>
				<div id="offset" style="width:120px; float:left; color:black; text-align: left; white-space: pre;"></div>
				<div id="rawBytes" style="width:100px; float:left; color:grey; text-align: left; white-space: pre;"></div>
				<div id="listing" style="width:600px; padding-left:300px; white-space: pre; font-weight: bold; 'Helvetica Neue', Helvetica, Arial, sans-serif"></div>
			</div>            
        </div>
        
        <!--  STRINGS TAB CONTENT -->
        <div class="tab-pane" id="strings">
            <div class="tabbed-scroll" id="strings-content"></div>
        </div>
        
        <!--  SECTIONS TAB CONTENT -->
        <div class="tab-pane" id="sections">
            <div class="tabbed-scroll" id="sections-content"></div>
        </div>           
    </div>
</div>  
      
<div id="modal-from-dom" class="modal hide fade">
    <div class="modal-header">
        <a href="#" class="close">&times;</a>
        <h3>File Upload</h3>
    </div>
     
    <div class="modal-body">
        <div>
            <div id="file_upload"></div>  
      	</div>
        {% include 'terms.html' %}        
    </div>
    
    <div class="modal-footer">
        <a href="#" class="btn primary" onclick="doFormSubmit()">Submit</a>
        <a href="#" class="btn secondary" onclick="doFormCancel()">Cancel</a>
    </div>
</div>
   

{% include 'help.html' %}  
      
{% endblock %}
        

